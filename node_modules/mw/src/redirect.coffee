isFunction = (obj) -> '[object Function]' is toString.call obj

permCode = 301
tempCode = 302

module.exports = (location, permanent = false) -> (req, res) ->
    statusCode = if permanent then permCode else tempCode
    loc = location
    loc = loc req if isFunction loc
    isBack = loc is 'back'
    loc = req.url if isBack
    loc = req.headers.referer if isBack and req?.headers?.referer?
    console.log "redirect to #{loc}"
    res.writeHead statusCode, {Location: loc}
    res.end()
